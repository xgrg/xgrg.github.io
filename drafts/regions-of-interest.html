<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Grégory Operto, ">
    <link href="/favicon.png" rel="icon">

        <link rel="alternate"  href="http://xgrg.github.io/feeds/all.atom.xml" type="application/atom+xml" title="Grégory Operto Full Atom Feed"/>

        <title>Grégory Operto - ROI-based analysis in neuroimaging: a tutorial in Python</title>

    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="/theme/css/grids-responsive-min.css">
    <!--<![endif]-->
    <link rel="stylesheet" href="/theme/css/styles.css">
    <link rel="stylesheet" href="/theme/css/slides.css">
    <link rel="stylesheet" href="/theme/css/pygments.css">
    <!-- <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'> -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,500" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>


    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

    <script src="/js/responsiveslides.min.js"></script>
</head>

<body>


    <header id="header" class="pure-g">
        <div class="pure-u-1 pure-u-md-3-4">
             <div id="menu">
                 <div class="pure-menu pure-menu-open pure-menu-horizontal">
<ul>
        <li><a href="/">Home</a></li>
        <li><a href="/about/">About</a></li>
</ul>                </div>
            </div>
        </div>

        <div class="pure-u-1 pure-u-md-1-4">
            <div id="social">
                <div class="pure-menu pure-menu-open pure-menu-horizontal">
<ul>
        <li><a href="https://twitter.com/xgrg"><i class="fa fa-twitter"></i></a></li>
        <li><a href="https://github.com/xgrg"><i class="fa fa-github"></i></a></li>
        <li><a href="https://www.linkedin.com/in/neuroimaging"><i class="fa fa-linkedin"></i></a></li>
</ul>                </div>
            </div>
        </div>
    </header>



    <div id="layout" class="pure-g">
        <nav id="sidebar" class="pure-u-1 pure-u-md-1-4">
            <div class="l-box">
<section>
	<div class="portrait">
			<img src="/theme/images/go.jpg" />
	</div>
    <div class="name-cv">
        <div class="name">Grégory Operto, PhD</div>
        <div class="cv">
            <a href="/pdfs/cv.pdf"><i class="fa fa-file-pdf-o"></i> CV</a>
        </div>
    </div>
    <div class="clear"></div>
      <div class="sub-name">brain imaging | data science</div>
	<div class="contact">goperto@gmail.com</div>
	<div class="location">Barcelona, Spain</div>
</section>

<section class="tags">
</section>            </div>
        </nav>
        <section id="content" class="pure-u-1 pure-u-md-3-4">
            <div class="l-box">

    <header id="post-header">
        <h1>ROI-based analysis in neuroimaging: a tutorial in Python</h1>
            <div class="post-meta">
                February 03, 2020
            </div>
            <div class="post-tags">
                <ul>
                    <li>tags:</li>
                    <li><a href="/tag/image/">image</a></li>
                    <li><a href="/tag/python/">python</a></li>
                </ul>
            </div>
    </header>

    <section id="post">
        <!-- PELICAN_END_SUMMARY -->

<p>As hypotheses in neuroimaging studies are often stated in terms of brain
structures, analyses based on Regions-on-Interest (ROIs) allow to focus
 over a number of parcels with homogeneous characteristics. Two approaches
 are generally available, as two opposite ways of addressing anatomical variability.</p>
<ul>
<li>One way consists in warping all the subjects to a common
reference space and using ROIs defined from a brain atlas.</li>
<li>The other one consists in delineating ROIs individually in every subject,
  e.g., using segmentation algorithms.  Resulting objects are likely to be closer
  to the individual anatomical truth, and improve sensitivity by focusing on
  the signal of interest, as compared to voxel-based methods.</li>
</ul>
<p>ROIs are thus often defined over anatomical data and then used to filter the
 signal from other image modalities.</p>
<p>## TL;DR</p>
<blockquote>
<p><div style="padding:20px; text-align:justify; background-color:#222222">
This post describes an end-to-end analysis workflow based on
regions-of-interest. Such workflows rely on typical operations
e.g. extracting values, merging them with covariates, plotting, performing some
linear regressions or group comparisons, which have been turned to Python code
in a package called <a href="https://github.com/xgrg/roistats">roistats</a>, presented here. </div></p>
</blockquote>
<h2>Collecting mean values from atlas regions</h2>
<p><code>roistats.collect</code> module has a function <code>roistats_from_maps(images, atlas_fp)</code>
which takes a set (<code>images</code>) of images (their file paths) and <code>atlas_fp</code>, the
 path to a <em>ROI volume</em> (i.e. a volume with integer labels defining areas of
   interest [and 0 elsewhere]). All images should be coregistered in the same
   space (e.g. MNI). The ROI volume may thus come from an atlas, as the ones
   from the <a href="https://nilearn.github.io/modules/reference.html#module-nilearn.datasets"><code>nilearn.datasets</code></a>
  module.</p>
<p>In this example, let us generate some maps (N=50) with some random values over an
MNI brain mask. They will be like our individual (subject-level) maps. You may
use your own maps directly.</p>
<h4>Generating random maps (optional)</h4>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">atlas</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_mni152_brain_mask</span><span class="p">()</span>

<span class="c1"># Generate 50 random maps</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="n">atlas</span><span class="o">.</span><span class="n">dataobj</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">atlas</span><span class="o">.</span><span class="n">dataobj</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">new_img_like</span><span class="p">(</span><span class="n">atlas</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">smooth_img</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.nii.gz&#39;</span><span class="p">)</span>
    <span class="n">im</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span> <span class="k">as</span> <span class="n">npl</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;cort-maxprob-thr50-2mm&#39;</span>
<span class="n">atlas_fp</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_atlas_harvard_oxford</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="s1">&#39;maps&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">images</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
    <span class="n">npl</span><span class="o">.</span><span class="n">plot_roi</span><span class="p">(</span><span class="n">atlas_fp</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">each</span><span class="p">)</span>
</pre></div>


<p>This <a href="https://gist.github.com/xgrg/3405bbe95f6aa589ac5dfbfb9843c73f">gist</a>
shows the documented execution of this part.</p>
<h4>Collecting values</h4>
<p>```python
from roistats import collect
from roistats import
df = collect.roistats_from_maps(images, atlas_fp, subjects=None)</p>
<p>df = df.rename(columns=labels)</p>
<p>df['group'] = df.index
df['age'] = df.apply (lambda row: random.random()*5+50, axis=1)
df['group'] = df.apply (lambda row: row['group']&lt;len(df)/2, axis=1)
df['index'] = df.index</p>
    </section>


<nav class="pagination-wrapper">
    <div class="pagination">
        <div class="pagination-left">
        </div>
        <div class="pagination-right">
                &nbsp;
        </div>
    </div>
</nav>
    <aside class="comments">

<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        this.page.url = "http://xgrg.github.io/drafts/regions-of-interest.html";  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = "regions-of-interest"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//xgrg.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

    </aside>

            </div>
        </section>


        <footer id="footer" class="pure-u-1 pure-u-md-3-4">
            <div class="l-box">
                <div>
                    <p>&copy; <a href="http://xgrg.github.io">Grégory Operto</a> &ndash;
                        Built with <a href="https://github.com/PurePelicanTheme/pure-single">Pure Theme</a>
                              for <a href="http://blog.getpelican.com/">Pelican</a> - layout cloned with awe from <a href="http://cyrille.rossant.net">cyrille.rossant.net</a>
                    </p>
                </div>
            </div>
        </footer>

    </div>
    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-17275957-2', 'auto');
    ga('send', 'pageview');
    </script>


</body>
</html>

